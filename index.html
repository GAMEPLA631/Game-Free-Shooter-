<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactic Brawlers</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Arial', sans-serif;
            color: #fff;
            text-align: center;
        }

        #gameCanvas {
            display: block;
        }

        #messageBox {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            display: none;
            font-size: 1.5rem;
            border: 2px solid #ffcc00;
        }

        #instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            text-align: left;
            z-index: 10;
        }
        
        #scoreDisplay {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 10;
        }

        .team-a-score {
            color: #00bfff; /* Modrá farba pre Team A */
        }
        
        .team-b-score {
            color: #ff4500; /* Oranžová farba pre Team B */
        }

        #timerDisplay {
            position: absolute;
            top: 50px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 10;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        #newGameButton {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        #newGameButton:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <!--
    Hlavný element, do ktorého Three.js vykreslí 3D scénu.
    -->
    <canvas id="gameCanvas"></canvas>

    <!--
    Jednoduchý div na zobrazovanie herných správ.
    -->
    <div id="messageBox"></div>

    <!--
    Inštrukcie pre hráča
    -->
    <div id="instructions">
        <h2>Inštrukcie</h2>
        <p>Pohyb: **W, A, S, D** alebo **šipky**</p>
        <p>Strieľanie: **Kliknite myšou**</p>
    </div>

    <!--
    Ukazovateľ skóre
    -->
    <div id="scoreDisplay">
        <span class="team-a-score">Modrý tím: 0</span> - <span class="team-b-score">Červený tím: 0</span>
    </div>

    <!--
    Časovač hry
    -->
    <div id="timerDisplay">
        Čas: 08:00
    </div>

    <!--
    Tlačidlo pre novú hru
    -->
    <div id="controls">
        <button id="newGameButton">Nová Hra</button>
    </div>

    <!--
    Pripojenie knižnice Three.js z CDN, ktorá je nevyhnutná pre 3D grafiku.
    -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // === Základné nastavenie scény (Scena, Kamera, Renderer) ===
        let scene, camera, renderer;
        let player;
        const fireballs = [];
        let keys = {};
        const playerSpeed = 0.1;
        const fireballSpeed = 0.5;
        const maxFireballs = 5;

        // Tímová logika
        const NUM_PLAYERS_PER_TEAM = 10;
        let teamA = []; // Modrý tím (hráč + AI)
        let teamB = []; // Červený tím (AI)
        let teamAScore = 0;
        let teamBScore = 0;
        const WIN_SCORE = 150; // Zmenený limit pre víťazstvo
        let isGameOver = false;

        // Časovač hry
        const GAME_DURATION = 8 * 60; // 8 minút v sekundách
        let timeLeft = GAME_DURATION;
        let gameInterval;

        // UI elementy
        const messageBox = document.getElementById('messageBox');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const newGameButton = document.getElementById('newGameButton');

        function showMessage(text, duration = 2000) {
            messageBox.textContent = text;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, duration);
        }

        function updateScoreDisplay() {
            scoreDisplay.innerHTML = `<span class="team-a-score">Modrý tím: ${teamAScore}</span> - <span class="team-b-score">Červený tím: ${teamBScore}</span>`;
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
            const formattedSeconds = seconds < 10 ? '0' + seconds : seconds;
            timerDisplay.textContent = `Čas: ${formattedMinutes}:${formattedSeconds}`;

            if (timeLeft <= 0) {
                endGameByTime();
            }
        }

        function endGameByTime() {
            isGameOver = true;
            clearInterval(gameInterval);
            let finalMessage = "";
            if (teamAScore > teamBScore) {
                finalMessage = "Koniec! Modrý tím vyhral!";
            } else if (teamBScore > teamAScore) {
                finalMessage = "Koniec! Červený tím vyhral!";
            } else {
                finalMessage = "Koniec! Remíza!";
            }
            showMessage(finalMessage, 5000);
        }

        function startNewGame() {
            // Resetovanie skóre a herného stavu
            teamAScore = 0;
            teamBScore = 0;
            timeLeft = GAME_DURATION;
            isGameOver = false;
            updateScoreDisplay();
            updateTimerDisplay();
            showMessage("Nová Hra Začína!", 2000);

            // Zastavenie a reštartovanie časovača
            clearInterval(gameInterval);
            gameInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
            }, 1000);

            // Odstránenie všetkých postáv a gulí zo scény
            [...teamA, ...teamB, ...fireballs].forEach(obj => {
                scene.remove(obj);
            });

            teamA = [];
            teamB = [];
            fireballs.length = 0;

            // Vytvorenie nových postáv a ich pridanie do scény
            initCharacters();
        }

        /**
         * Vytvorí novú postavu (hráča alebo AI) s danou farbou.
         * @param {string} teamColor Farba tímu (napr. 0x00bfff alebo 0xff4500).
         * @param {boolean} isPlayer Určuje, či ide o postavu hráča.
         * @param {boolean} isProfessional Určuje, či ide o profesionálneho AI bojovníka.
         * @returns {object} Objekt s meshom a hernými vlastnosťami.
         */
        function createCharacter(teamColor, isPlayer = false, isProfessional = false) {
            const characterGeometry = new THREE.SphereGeometry(1, 32, 32);
            let characterMaterial;

            if (isProfessional) {
                // Profesionálny AI má iný materiál, aby žiaril
                characterMaterial = new THREE.MeshStandardMaterial({
                    color: 0xffd700, // Zlatá farba
                    emissive: 0xffd700,
                    emissiveIntensity: 1.5
                });
            } else {
                characterMaterial = new THREE.MeshBasicMaterial({ color: teamColor });
            }

            const characterMesh = new THREE.Mesh(characterGeometry, characterMaterial);
            characterMesh.position.y = 0.5;

            // Zväčšenie profesionálneho AI
            if (isProfessional) {
                characterMesh.scale.set(1.5, 1.5, 1.5);
            }

            // Pridanie menovky s tímom a typom AI pre jednoduchšiu identifikáciu
            characterMesh.userData = {
                team: teamColor === 0x00bfff ? 'A' : 'B',
                health: 100,
                isPlayer: isPlayer,
                isAlive: true,
                isProfessional: isProfessional,
                respawnTime: 0,
                moveDirection: new THREE.Vector3(0, 0, 0),
                shootCooldown: 0,
            };

            return characterMesh;
        }

        /**
         * Vytvorí novú ohnivú guľu vrátane efektu žiarenia.
         * @param {string} ownerTeam Tím, ktorý guľu vystrelil.
         * @returns {THREE.Group} Skupina obsahujúca guľu a jej žiarenie.
         */
        function createFireball(ownerTeam) {
            const fireballGroup = new THREE.Group();
            const fireballGeometry = new THREE.SphereGeometry(0.5, 16, 16);
            const fireballMaterial = new THREE.MeshBasicMaterial({ color: 0xff4500 });
            const fireballMesh = new THREE.Mesh(fireballGeometry, fireballMaterial);
            fireballGroup.add(fireballMesh);

            const glowGeometry = new THREE.SphereGeometry(0.6, 16, 16);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0xffa500,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });
            const glowMesh = new THREE.Mesh(glowGeometry, glowMaterial);
            fireballGroup.add(glowMesh);

            // Uložíme tím strelca, aby nezasiahol svojich
            fireballGroup.userData.ownerTeam = ownerTeam;

            return fireballGroup;
        }

        function initCharacters() {
            // Vytvorenie postáv
            player = createCharacter(0x00bfff, true);
            scene.add(player);
            teamA.push(player);

            // Vytvorenie jedného profesionálneho AI hráča
            const professionalAI = createCharacter(0xff4500, false, true);
            professionalAI.position.x = Math.random() * 80 - 40;
            professionalAI.position.z = Math.random() * 80 - 40;
            scene.add(professionalAI);
            teamB.push(professionalAI);
            
            // Vytvorenie zvyšných AI postáv pre oba tímy
            for (let i = 0; i < NUM_PLAYERS_PER_TEAM - 1; i++) {
                const aiA = createCharacter(0x00bfff);
                aiA.position.x = Math.random() * 80 - 40;
                aiA.position.z = Math.random() * 80 - 40;
                scene.add(aiA);
                teamA.push(aiA);

                const aiB = createCharacter(0xff4500);
                aiB.position.x = Math.random() * 80 - 40;
                aiB.position.z = Math.random() * 80 - 40;
                scene.add(aiB);
                teamB.push(aiB);
            }
        }

        function init() {
            // Vytvorenie scény
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a23);

            // Vytvorenie kamery
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 20;
            camera.position.y = 15;
            camera.lookAt(0, 0, 0);

            // Vytvorenie renderera
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('gameCanvas') });
            renderer.setSize(window.innerWidth, window.innerHeight);

            // Mapa - jednoduchá vesmírna plocha
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = new THREE.MeshBasicMaterial({ color: 0x33334d, side: THREE.DoubleSide });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = Math.PI / 2;
            scene.add(ground);

            // Pridanie svetiel pre lepší vizuál
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);

            // Inicializácia postáv a spuštění novej hry
            startNewGame();
        }

        // === Riešenie vstupov od užívateľa ===
        function onKeyDown(event) {
            keys[event.key.toLowerCase()] = true;
            if (event.key === 'ArrowUp') keys['w'] = true;
            if (event.key === 'ArrowDown') keys['s'] = true;
            if (event.key === 'ArrowLeft') keys['a'] = true;
            if (event.key === 'ArrowRight') keys['d'] = true;
        }

        function onKeyUp(event) {
            keys[event.key.toLowerCase()] = false;
            if (event.key === 'ArrowUp') keys['w'] = false;
            if (event.key === 'ArrowDown') keys['s'] = false;
            if (event.key === 'ArrowLeft') keys['a'] = false;
            if (event.key === 'ArrowRight') keys['d'] = false;
        }

        function onMouseDown(event) {
            // Kontrola či hra neskončila, ale už žiadne obmedzenie počtu gulí
            if (isGameOver) {
                return;
            }

            const fireball = createFireball(player.userData.team);
            fireball.position.copy(player.position);
            
            const direction = new THREE.Vector3();
            camera.getWorldDirection(direction);
            direction.y = 0;
            direction.normalize();

            fireball.userData.direction = direction;
            fireball.userData.velocity = fireballSpeed;

            scene.add(fireball);
            fireballs.push(fireball);
        }

        // === Herná logika a aktualizácia stavu ===
        function checkCollisions() {
            if (isGameOver) return;
            
            for (let i = fireballs.length - 1; i >= 0; i--) {
                const fireball = fireballs[i];
                let hit = false;
                
                // Kontrola kolízie s postavami z opačného tímu
                const targetTeam = fireball.userData.ownerTeam === 'A' ? teamB : teamA;
                
                for (const character of targetTeam) {
                    if (!character.userData.isAlive) continue;
                    
                    // Upravená kontrola vzdialenosti kvôli zväčšeniu profesionálneho AI
                    const distance = fireball.position.distanceTo(character.position);
                    const hitRadius = character.userData.isProfessional ? 2.5 : 2;

                    if (distance < hitRadius) {
                        character.userData.health -= 50; // Zníženie zdravia
                        hit = true;
                        
                        // Zomrel?
                        if (character.userData.health <= 0) {
                            character.userData.isAlive = false;
                            character.visible = false;
                            
                            // Aktualizácia skóre
                            if (fireball.userData.ownerTeam === 'A') {
                                teamAScore++;
                            } else {
                                teamBScore++;
                            }
                            updateScoreDisplay();
                            
                            // Kontrola, či hra skončila
                            if (teamAScore >= WIN_SCORE || teamBScore >= WIN_SCORE) {
                                isGameOver = true;
                                showMessage(`${teamAScore >= WIN_SCORE ? 'Modrý tím' : 'Červený tím'} vyhral!`, 5000);
                            }
                            
                            // Respawn po 3 sekundách
                            setTimeout(() => {
                                if (!isGameOver) {
                                    resetCharacter(character);
                                }
                            }, 3000);
                        }
                    }
                }
                
                // Odstránenie ohnivej gule po kolízii
                if (hit) {
                    scene.remove(fireball);
                    fireballs.splice(i, 1);
                }
            }
        }

        function resetCharacter(character) {
            character.userData.isAlive = true;
            character.userData.health = 100;
            character.visible = true;
            character.position.set(Math.random() * 80 - 40, 0.5, Math.random() * 80 - 40);
        }

        function updateAI() {
            if (isGameOver) return;
            
            // Logika AI pre obe tímy
            const allCharacters = [...teamA, ...teamB];

            allCharacters.forEach(character => {
                if (!character.userData.isAlive || character.userData.isPlayer) return;
                
                // Určenie rýchlosti a náhody pre profesionálneho AI
                const speed = character.userData.isProfessional ? 0.1 : 0.05; // Zvýšenie rýchlosti profi AI
                const shootChance = character.userData.isProfessional ? 0.015 : 0.005; // Zvýšenie šance na streľbu

                // Pohyb AI
                const now = performance.now();
                if (!character.userData.nextMoveTime || now > character.userData.nextMoveTime) {
                    character.userData.moveDirection.x = (Math.random() - 0.5) * 2;
                    character.userData.moveDirection.z = (Math.random() - 0.5) * 2;

                    // Kontrola hraníc mapy a zmena smeru, ak sa blíži k okraju
                    const boundary = 40;
                    if (character.position.x > boundary) character.userData.moveDirection.x = -1;
                    if (character.position.x < -boundary) character.userData.moveDirection.x = 1;
                    if (character.position.z > boundary) character.userData.moveDirection.z = -1;
                    if (character.position.z < -boundary) character.userData.moveDirection.z = 1;

                    character.userData.nextMoveTime = now + (Math.random() * 2000 + 1000); // Nový smer každú 1-3 sekundy
                }
                
                character.position.x += character.userData.moveDirection.x * speed;
                character.position.z += character.userData.moveDirection.z * speed;
                
                // Strieľanie AI
                if (Math.random() < shootChance) { // Väčšia šanca pre profesionálneho AI
                    const fireball = createFireball(character.userData.team);
                    fireball.position.copy(character.position);
                    
                    const direction = new THREE.Vector3();
                    if (character.userData.isProfessional) {
                        // Profesionálny AI mieri na najbližšieho hráča z opačného tímu
                        const enemies = character.userData.team === 'A' ? teamB : teamA;
                        let closestEnemy = null;
                        let minDistance = Infinity;

                        enemies.forEach(enemy => {
                            if (enemy.userData.isAlive) {
                                const distance = character.position.distanceTo(enemy.position);
                                if (distance < minDistance) {
                                    minDistance = distance;
                                    closestEnemy = enemy;
                                }
                            }
                        });

                        if (closestEnemy) {
                             direction.subVectors(closestEnemy.position, character.position).normalize();
                        } else {
                            // Ak nie je cieľ, strieľaj náhodne
                            direction.x = (Math.random() - 0.5) * 2;
                            direction.z = (Math.random() - 0.5) * 2;
                            direction.y = 0;
                            direction.normalize();
                        }
                    } else {
                        // Ostatné AI strieľajú náhodne
                        direction.x = (Math.random() - 0.5) * 2;
                        direction.z = (Math.random() - 0.5) * 2;
                        direction.y = 0;
                        direction.normalize();
                    }
                    
                    fireball.userData.direction = direction;
                    fireball.userData.velocity = fireballSpeed;

                    scene.add(fireball);
                    fireballs.push(fireball);
                }
            });
        }
        
        function animate() {
            requestAnimationFrame(animate);

            if (isGameOver) {
                renderer.render(scene, camera);
                return;
            }

            // Pohyb hráča
            const playerMoveVector = new THREE.Vector3(0, 0, 0);
            if (keys['w']) playerMoveVector.z -= playerSpeed;
            if (keys['s']) playerMoveVector.z += playerSpeed;
            if (keys['a']) playerMoveVector.x -= playerSpeed;
            if (keys['d']) playerMoveVector.x += playerSpeed;
            
            player.position.add(playerMoveVector);

            // Aktualizácia pozície kamery, aby sledovala hráča
            camera.position.x = player.position.x;
            camera.position.z = player.position.z + 15;
            camera.lookAt(player.position);

            // Aktualizácia AI a pohyb ohnivých gulí
            updateAI();
            fireballs.forEach(fireball => {
                fireball.position.addScaledVector(fireball.userData.direction, fireball.userData.velocity);
            });

            // Odstránenie gulí, ktoré sú mimo mapy
            for (let i = fireballs.length - 1; i >= 0; i--) {
                const fireball = fireballs[i];
                if (Math.abs(fireball.position.x) > 50 || Math.abs(fireball.position.z) > 50) {
                    scene.remove(fireball);
                    fireballs.splice(i, 1);
                }
            }

            checkCollisions();
            renderer.render(scene, camera);
        }

        // Spustenie hry po načítaní okna
        window.onload = function() {
            init();
            animate();
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            document.addEventListener('mousedown', onMouseDown);
            newGameButton.addEventListener('click', startNewGame);

            // Reakcia na zmenu veľkosti okna
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        };
    </script>
</body>
</html>




